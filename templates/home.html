{% extends "base.html" %}

{% block title %}Home - WikiWare{% endblock %}

{% block content %}
<div class="container">

    <div class="create-page">
        <h3>Create a New Page</h3>
        <form onsubmit="createNewPage(event)">
            <input type="text" id="new_page_title" placeholder="Enter page title" required>
            <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Create Page</button>
        </form>
    </div>

    <script>
        function createNewPage(event) {
            event.preventDefault();
            const title = document.getElementById('new_page_title').value.trim();
            if (title) {
                const currentBranch = '{{ branch or "main" }}';
                window.location.href = '/edit/' + encodeURIComponent(title) + '?branch=' + encodeURIComponent(currentBranch);
            }
        }
    </script>

    <div class="recent-pages">
        <h3>Recent Pages</h3>
        {% if offline %}
        <div class="offline-message">
            <p><i class="fas fa-exclamation-triangle"></i> Database not available. Running in offline mode.</p>
            <p>You can still view the interface, but changes won't be saved.</p>
        </div>
        {% elif pages %}
        <div class="page-list">
            {% for page in pages %}
            <div class="page-item">
                <h4><a href="/page/{{ page.title }}?branch={{ page.branch or 'main' }}">{{ page.title }}</a></h4>
                <p>Last updated: {{ page.updated_at.strftime('%Y-%m-%d %H:%M') }} by {{ page.author }}{% if page.branch and page.branch != 'main' %} (Branch: {{ page.branch }}){% endif %}</p>
                <a href="/edit/{{ page.title }}?branch={{ page.branch or 'main' }}" class="btn btn-secondary"><i class="fas fa-edit"></i> Edit</a>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No pages yet. <a href="/edit/Home?branch={{ branch or 'main' }}">Create the first one!</a></p>
        {% endif %}
    </div>
</div>
{% endblock %}
